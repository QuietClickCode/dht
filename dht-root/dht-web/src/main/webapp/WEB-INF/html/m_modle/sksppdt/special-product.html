<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>特价商品</title>
    <script src="/js/Adaptive.js"></script>
    <script src="/js/laydate/laydate.js"></script>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/new.css">
</head>

<body class="bge6">
<!--分享引导-->
<div class="guide-share" style="display: none;position: fixed">
    <button class="i-know" onclick="ikonw();"></button>
</div>
<div class="specialty-title2 borderB">
    <a onclick="returnhistory();" class="icon-return"></a>
    <span>商品详情</span>
</div>

<div id="banner" class="focus">
    <div class="hd bargain">
        <ul></ul>
    </div>
    <div class="bd">
        <ul id="goodsImagesul" style="height: 200px">
            <!--<li>-->
                <!--<img _src="/img/banner1.jpg" src="/img/bangain5.png" />-->
            <!--</li>-->
        </ul>
        <!-- 倒计时 -->
        <div class="product-countDown2">
            <span id="minprice" class="price"></span>
            <span class="special-text">特价</span>
            <s id="gprice"></s>
            <div class="time-box">
                <p class="text">距结束仅剩</p>
                <div class="time-span">
                    <span id="shi1" class="time">0</span>
                    <span id="shi2" class="time">0</span>
                    <span class="colon">:</span>
                    <span id="fen1" class="time">0</span>
                    <span id="fen2" class="time">0</span>
                    <span class="colon">:</span>
                    <span id="miao1" class="time">0</span>
                    <span id="miao2" class="time">0</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="bargain-text box2">
    <div class="title" id="goodsNameDiv"></div>
    <div class="seckill-address" id="personaddressdiv">
        <div class="text" >
            <span class="seckill-address-title">产自</span>
            <div class="name" id="gproductioninperson"></div>
            <span class="address-text">
                    <i></i>
                    <span id="gproductioninaddress"></span>
                </span>
        </div>
        <div class="text" >
            <span class="seckill-address-title">采供</span>
            <div class="name" id="gpickperson"></div>
            <span class="address-text">
                    <i></i>
                    <span id="gpickaddress"></span>
                </span>
        </div>
    </div>
    <div class="norms" id="open_car" onclick="loadgsval();">
        <span class="name">已选</span>
        <span class="text overflow" id="nowhasgsvalspan"> 请选择规格</span>
        <span class="checkbox"></span>
    </div>
    <div class="norms showaddressfreigh" onclick="loadAddress();">
        <span class="name">送至</span>
        <span class="text overflow" id="open_address">请选择地址 <!--重庆市九龙坡区狮山大道巴南小区刚光华苑1栋...--></span>
        <span class="checkbox"></span>
    </div>
    <div class="norms showaddressfreigh">
        <span class="name">运费</span>
        <span class="text overflow" id="gfreigh"> 0.0元</span>
    </div>
    <div class="norms" id="open_time" >
        <span class="name">配送</span>
        <span class="text overflow"> 选择配送时间</span>
        <span class="checkbox"></span>
    </div>
    <div class="norms" id="isAdvancesalediv">
        <span class="name">预售</span>
        <span class="text overflow"> </span>
    </div>

    <div class="ensure" style="display: none;">
            <span>
                <i class="icon-yes"></i>
                农家自产
            </span>
        <span>
                <i class="icon-yes2"></i>
                农家自产
            </span>
        <span>
                <i class="icon-yes"></i>
                农家自产
            </span>
        <span>
                <i class="icon-yes"></i>
                农家自产
            </span>
    </div>

    <div class="loading-more">
        <i></i>
        上拉查看图文详情
    </div>
</div>

<div class="bargain-details box2">
    <div class="bargain-tab" id="J_bargainTab">
        <a href="#details" class="active">商品介绍</a>
        <a href="#evaluate">用户评价</a>
    </div>

    <div class="box2">

        <div class="product-details" id="details">
            <!-- 商品信息 -->
            <div class="like">
                <div class="cont">
                    <span class="bargain-like">商品信息</span>
                </div>
            </div>

            <div id="gdescription">
                <img src="/img/bangain5.png" class="dispalyB" width="100%" alt="">
            </div>
        </div>

        <div class="product-evaluate box2 displayN" id="evaluate">
            <div class="title">
                <span id="sumgclsspan"> </span>
                <div class="stars1" id="avgleveldiv">
                    <!--<i></i>-->
                    <!--<i></i>-->
                    <!--<i></i>-->
                    <!--<i></i>-->
                    <!--<i></i>-->
                </div>
            </div>
            <div class="label box2" id="singlegcldiv">
                <!--<span>新鲜(1800)</span>-->
                <!--<span>新鲜(1800)</span>-->
                <!--<span>新鲜(1800)</span>-->
                <!--<span>新鲜(1800)</span>-->
                <!--<span>新鲜(1800)</span>-->
            </div>

            <!-- 用户评价 -->
            <div id="usercommentdiv">

                <div class="user-evaluate">
                    <div class="box2">
                        <img src="/img/class1.png" class="img" alt="">
                        <div class="text">hz2375</div>
                        <div class="stars2">
                            <!--<i></i>-->
                            <!--<i></i>-->
                            <!--<i></i>-->
                            <!--<i></i>-->
                            <!--<i></i>-->
                        </div>
                    </div>
                    <div class="label2 box2">
                        <!--<span>新鲜</span>-->
                        <!--<span>新鲜</span>-->
                        <!--<span>新鲜</span>-->
                        <!--<span>新鲜</span>-->
                    </div>
                </div>

            </div>


            <div class="more" id="nogoodscldiv">

            </div>

        </div>

    </div>
</div>

<div class="placeholder-footer2"></div>
<div class="bargain-footer">
    <div class="special">
        <div class="share">
            <a onclick="shareGoods()">
                <i></i>
                <p>分享好友</p>
            </a>
        </div>
        <!-- <div class="care">
            <a href="">
                <i>
                    <span class="number">4</span>
                </i>
                <p>分享好友</p>
            </a>
        </div> -->
    </div>
    <a onclick="buynow()" class="bargain-btn2">立即购买</a>
    <a id="putdown" class="bargain-btn1" style="width: 100%;display: none">商品已下架</a>
    <a id="hasBuy" class="bargain-btn1" style="width: 100%;display: none">您已购买该商品</a>
</div>
<!--选择规格弹框-->
<div class="mark" id="J_mark2" style="display:none;">
    <div class="care-norms-checkbox J_careNormsCheckbox" style="display:block;">
        <i class="care-norms-close J_careNormsClose2" id="closegsdiv"></i>
        <div class="product" id="product">
            <img src="" alt="">
            <div class="text">
                <span class="mr_4" style="color: #ec3c3c;"></span>
                <br />
                <span></span>
            </div>
        </div>
        <div id="gsdiv">
            <!--<div class="care-checkbox J_careCheckbox">-->
                <!--<span class="name">规格1</span>-->
                <!--<span class="checkbox_service">人工费=</span>-->
                <!--<span class="checkbox_service">人工</span>-->
                <!--<span class="checkbox_service" >材)</span>-->
            <!--</div>-->

        </div>

        <div class="care-checkbox" style="margin-top: .2rem;">
            <span class="name">数量</span>
            <div class="number number-box">
                <span class="reduce J_careReduce" onclick="pdmaxinventory('-');">-</span>
                <span class="num J_careNum" id="goodsnumber">1</span>
                <span class="add J_careAdd" onclick="pdmaxinventory('+');">+</span>
            </div>
        </div>

        <div class="car_footer_box">
            <a id="setgsvala" onclick="suregsa();" class="add_car_btn2" style="width: 100%">确定</a>
        </div>
    </div>
</div>

<div class="mark" id="J_mark3" style="display:none;">
    <div class="care-norms-checkbox J_careNormsCheckbox" style="display:block;">
        <i class="care-norms-close J_careNormsClose3"></i>
        <p class="J_mark_title">选择配送时间</p>
        <div class="care-checkbox J_careCheckbox">
            <select name="" class="select_input" id="pstimeselect">
                <option value="周一至周五">周一至周五</option>
                <option value="周末">周末</option>
            </select>
            <center>
                <input type="text"  id="select_time" value="" style="border: 1px black solid;margin: 0 auto"/>
            </center>
        </div>
        <a onclick="setpstime()" class="care-norms-checkbox-btn">确定</a>
    </div>
</div>

<div class="mark" id="J_mark" style="display:none;">
    <div class="care-norms-checkbox J_careNormsCheckbox" style="display:block;">
        <i class="care-norms-close J_careNormsClose" id="closeaddress"></i>
        <p class="J_mark_title">送至</p>
        <ul class="address_list_box" id="addresul">
            <!--<li class="active">-->
                <!--<span class="address_img"></span>-->
                <!--<div class="address_text">重庆市九龙坡区狮山大道巴南小区刚光华苑1栋</div>-->
                <!--<span  class="icon_choice"></span>-->
            <!--</li>-->
        </ul>
        <a onclick="setaddress(this)" class="care-norms-checkbox-btn">确定</a>
    </div>
</div>

<script src="/js/jquery-1.9.1.min.js"></script>
<script src="/js/public.js"></script>
<script src="/js/TouchSlide.1.1.js"></script>
<script src="/js/tabs.js"></script>
<script src="/js/jquery.lazyload.js?v=1.9.1"></script>
<script src="/js/layer/layer.js"></script>
<!--时间减少-->
<script>
    var timestape = 0;
    function timegoing() {
        var interval = setInterval(function () {
            var date = new Date(timestape);
            var shi1 = Math.floor((date.getHours()-8)/10);
            var shi2 = Math.floor((date.getHours()-8)%10);
            var fen1 = Math.floor(date.getMinutes()/10);
            var fen2 = Math.floor(date.getMinutes()%10);
            var miao1 = Math.floor(date.getSeconds()/10);
            var miao2 = Math.floor(date.getSeconds()%10);

            $('#shi1').html(shi1);
            $('#shi2').html(shi2);
            $('#fen1').html(fen1);
            $('#fen2').html(fen2);
            $('#miao1').html(miao1);
            $('#miao2').html(miao2);

            timestape -= 1000;
            if(timestape<0){
                clearInterval(interval);
//                $('#shi1').parent().parent().next().remove();
//                $('#shi1').parent().parent().remove();
            }
        },1000);
    }

</script>
<!--定义使用函数-->
<script>
    var path = window.location.pathname;
    var pathArr = path.substring(10,path.indexOf('.html')).split('~');
    var gid = parseInt(pathArr[0]);
    <!--邀请者Id-->
    var inviterId;
    <!--初始化微信配置所用到的path-->
    var initSharePath;
    initSharePath = path.substring(0,10)+gid;
    if(pathArr.length==2){
        inviterId = pathArr[1].split('_')[1];
    }
//    alert(inviterId);
    var isServiceGoods;
    <!--用户评论分页查询-->
    var pageNo=1;
    var pageSize=10;
    var parentId;

    <!--初始化banner-->
    function initbanner() {
        TouchSlide({
            slideCell: "#banner",
            titCell: ".hd ul", //开启自动分页 autoPage:true ，此时设置 titCell 为导航元素包裹层
            mainCell: ".bd ul",
            effect: "left",
            autoPlay: true, //自动播放
            autoPage: true, //自动分页
            switchLoad: "_src" //切换加载，真实图片路径为"_src"
        });
    }

    <!--获取纯文本内容-->
    function removeHTMLTag(str) {
        str = str.replace(/<\/?[^>]*>/g,''); //去除HTML tag
        str = str.replace(/[ | ]*\n/g,'\n'); //去除行尾空白
        //str = str.replace(/\n[\s| | ]*\r/g,'\n'); //去除多余空行
        str=str.replace(/&nbsp;/ig,'');//去掉&nbsp;
        str=str.replace(/\s/g,''); //将空格去掉
        return str;
    }

    <!--加载商品图片-->
    function loadgoodsimage() {
        $.ajax({
            type:"post",
            url:'/goodsImage/queryGoodsImages',
            dataType: "json",
            data:{gid:gid,pageNo:1,pageSize:100},
            success:function(data){
                var goodsImages = data.goodsImages;
                if(goodsImages!=null&&goodsImages.length>0){
                    var html = '';
                    $('#goodsImagesul').html(html);
                    for(var i=0;i<goodsImages.length;i++){
                        html = '<li>'+
                            '<img _src="'+goodsImages[i].imgUrl+'" src="'+goodsImages[i].imgUrl+'" style="height: 200px" />'+
                            '</li>';
                        $('#goodsImagesul').append(html);
                    }
                }
                initbanner();
                $("img").lazyload({effect: "fadeIn"});
            }
        });
    }
    var spId;
    <!--加载剩余时间-->
    function loadtimestape() {
        $.ajax({
            type:"post",
            url:'/openSalePromotion/querySalePromotionLists',
            dataType: "json",
            data:{now:new Date().pattern('yyyy-MM-dd hh:mm:ss'),spType:0,gid:gid,pageNo:1,pageSize:1},
            success:function(data){
                if(data.rows!=null){
                    spId=data.rows[0].spId;
                    <!--查询用户是否购买此商品-->
                    queryuserisbuygoods();
                    timestape = data.rows[0].timestap*1000;
                    $('#gprice').html('￥'+parseFloat(data.rows[0].gprice/100).toFixed(2));
                    $('#goodsNameDiv').html(data.rows[0].goodsName);
                    $('#minprice').html('￥'+parseFloat(data.rows[0].minprice/100).toFixed(2));
                    parentId = data.rows[0].parentId;
                    timegoing();
                }else{
                    nogoods();
                }

            }
        });
    }

    <!--加载采摘人和地址-->
    function loadpersonaddress() {
        $.ajax({
            type:"post",
            url:'/goods/queryGoodsById',
            dataType: "json",
            data:{gid:gid,isShow:1,isChecked:1},
            success:function(data){
                var row = data.row;
                if(row!=null){
                    var gproductioninperson = row.gproductioninperson;
                    var gproductioninaddress = row.gproductioninaddress;
                    var gpickperson = row.gpickperson;
                    var gpickaddress = row.gpickaddress;
                    if(gproductioninperson==''||gproductioninaddress==''||gpickperson==''||gpickaddress==''){
                        $('#personaddressdiv').hide();
                    }else{
                        $('#gproductioninperson').html(gproductioninperson);
                        $('#gproductioninaddress').html(gproductioninaddress);
                        $('#gpickperson').html(gpickperson);
                        $('#gpickaddress').html(gpickaddress);
                    }
                    $('#gdescription').html(row.gdescription);
                }else{
                    nogoods();
                }
            }
        });
    }

    var startbuy = -1;
    var goodsisMultiplebuy = 0;
    <!--加载商品配置-->
    function loadgoodsconfig() {
        $.ajax({
            type:"post",
            url:'/goodsConfig/queryGoodsConfigBygid',
            dataType: "json",
            data:{gid:gid,pageNo:1,pageSize:2},
            success:function(data){
                var goodsConfig = data.goodsConfig;
                if(goodsConfig!=null){
                    isServiceGoods = goodsConfig.isServicegoods;
                    var isAllowsetdeliverytime = goodsConfig.isAllowsetdeliverytime;
                    var isAdvancesale = goodsConfig.isAdvancesale;
                    var isPutway = goodsConfig.isPutway;

                    if(isPutway==0){
                        $('.bargain-btn2').hide();
                        $('#putdown').show();
                        $('#hasBuy').hide();
                        $('.special').hide();
                    }
                    if(isAdvancesale==1){
                        $($('#isAdvancesalediv').find('span').get(1)).html(goodsConfig.gedt+'发货');
                        $('#isAdvancesalediv').show();
                    }else{
                        $('#isAdvancesalediv').hide();
                    }
                    if(isServiceGoods==1){
                        $('.showaddressfreigh').hide();
                        $($('#open_time').find('span')[1]).html('请选择服务时间');
                        $('.select_input').hide();
                        $('#select_time').show();
                        $('#isAdvancesalediv').hide();
                    }else{
                        $('.showaddressfreigh').show();
                        $('.select_input').show();
                        $('#select_time').hide();
                        $('#isAdvancesalediv').show();
                    }
                    if(isAllowsetdeliverytime==1){
                        $('#open_time').show();
                    }else{
                        $('#open_time').hide();
                    }
                    var gstartbuy = goodsConfig.gstartbuy;
                    var isMultiplebuy = goodsConfig.isMultiplebuy;

                    if(gstartbuy!=''&&gstartbuy!=null){
                        startbuy = gstartbuy;
                        $('#goodsnumber').html(startbuy);
                    }
                    if(isMultiplebuy==1){
                        goodsisMultiplebuy = isMultiplebuy;
                    }
                }else{
                    nogoods();
                }
            }
        });
    }

    <!--设置地址和运费-->
    function setaddress(obj) {
        var address = $(obj).prev().find('li[class=active]').find('div').html();
        $('#open_address').html(address);
        $.ajax({
            type:"post",
            url:'/city/queryCityListsByCityName',
            dataType: "json",
            data:{cityname:address.substr(0,2),pageNo:1,pageSize:2},
            success:function(data){
                var row = data.row;
                if(row!=null){
                    var gfreigh = row.gfreigh;
                    $('#gfreigh').html(gfreigh+'元');
                }
            }
        });

        document.getElementById('closeaddress').click();
    }

    <!--商品不存在 跳转页面-->
    function nogoods() {
        window.location.href='/home/lostHtml';
    }

    var flag = true;
    <!--滚动加载商品评论-->
    function scrollgoodsclm() {
        $(document).ready(function(){
            $('#usercommentdiv').html('');
            var range = 50;             //距下边界长度/单位px
            var totalheight = 0;
            var main = $("#usercommentdiv");                     //主体元素
            $(window).scroll(function(){
                var srollPos = $(window).scrollTop();    //滚动条距顶部距离(页面超出窗口的高度)

                totalheight = parseFloat($(window).height()) + parseFloat(srollPos);

                if(($(document).height()-range) <= totalheight && flag) {
                    flag = false;
                    $.ajax({
                        type:"post",
                        url:'/goodsUggclrel/queryGoodsUggclrel',
                        dataType: "json",
                        async :false,
                        data:{gid:gid,pageNo:pageNo,pageSize:pageSize},
                        success:function(data){
                            var html = '';
                            var rows = data.rows;
                            if(rows!=null&&rows.length>0){
                                for(var i=0;i<rows.length;i++){
                                    var gcllevel = parseInt(rows[i].gcllevel);
                                    var gclnames = rows[i].gclname.split(' ');
                                    html = '<div class="user-evaluate ">'+
                                        '<div class="box2">'+
                                        '<img src="'+rows[i].imgurl+'" class="img" alt="">'+
                                        '<div class="text">'+rows[i].uname+'</div>'+
                                        '<div class="stars2">';

                                    for(var j=0;j<gcllevel;j++){
                                        html += '<i></i>';
                                    }

                                    html += '</div>'+
                                        '</div>'+
                                        '<div class="label2 box2">';

                                    for(var j=0;j<gclnames.length;j++){
                                        html += '<span>'+gclnames[j]+'</span>';
                                    }
                                    html += '</div>'+
                                        '</div>';
                                    main.append(html);
                                }
                                pageNo++;
                                flag = true;
                            }else{
                                html = '<a >已全部加载</a>';
                                $('#nogoodscldiv').html(html);
                            }
                        }
                    });

                }
            });
        });
    }

    <!--全部评论数量及平均分数-->
    function sumgclandavglevel() {
        $.ajax({
            type:"post",
            url:'/goodsUggclrel/queryGoodsclsumandavg',
            dataType: "json",
            async :false,
            data:{gid:gid},
            success:function(data){
                var row = data.row;
                if(row!=null){
                    $('#sumgclsspan').html('全部评论（'+row.sumgcl+'）');
                    var avglevel = Math.round(row.avglevel);
                    $('#avgleveldiv').html('');
                    for(var i=0;i<avglevel;i++){
                        var html = '<i></i>';
                        $('#avgleveldiv').append(html);
                    }
                }
            }
        });
    }

    <!--加载已有评论-->
    function loadhasgcl() {
        $.ajax({
            type:"post",
            url:'/goodsUggclrel/queryHasGoodscls',
            dataType: "json",
            async :false,
            data:{gid:gid},
            success:function(data){
                var rows = data.rows;
                if(rows!=null&&rows.length>0){
                    var html = '';
                    $('#singlegcldiv').html(html);
                    for(var i=0;i<rows.length;i++){
                        html = '<span>'+rows[i].gclname+'('+rows[i].siglegclsum+')</span>';
                        $('#singlegcldiv').append(html);
                    }
                }

            }
        });
    }


    var ginventory=0;
    var spBounds = 0;
    var canbuy = 0;
    <!--点击修改规格样式-->
    function clickactive(obj) {
        $(obj).parent().children().removeClass('active');
        $(obj).addClass('active');
        loadgsval();
    }

    <!--规格加载信息-->
    function loadgsval() {
        var gsdivs = $('#gsdiv').find('div[name=gsdivs]');
        var gsvalactive = $('#gsdiv').find('.active');
//            //alert('gsdivs---'+gsdivs.length);
//            //alert('gsvalactive---'+gsvalactive.length);
        if(gsdivs.length==gsvalactive.length){
            var gsvids = '';
            for(var i=0;i<gsvalactive.length;i++){
                gsvids += ','+$(gsvalactive[i]).find('input')[0].value;
            }
            gsvids = gsvids.substr(1);
            $.ajax({
                type:"post",
                url:'/openGoodsGdsprel/queryGoodsGdsprelVoLists',
                dataType: "json",
                async :false,
                data:{gid:gid,gsvalIds:gsvids,parentId:parentId},
                success:function(data){
                    var row = data.row;
                    if(row!=null){
                        var imgUrl = row.imgurl;
                        var price = parseFloat(row.spSale/100).toFixed(2);
                        var inventory = row.spInventory;
                        var gunitname = row.gunitname;

                        var img = $('#product').find('img')[0];
                        var pricespan = $('#product').find('span')[0];
                        var inventoryspan = $('#product').find('span')[1];

                        if(imgUrl.substring(imgUrl.length-4,imgUrl.length)=='null'){
                            img.src = $('#goodsImagesul').find('img')[0].src;
                        }else{
                            img.src = imgUrl;
                        }

                        if(inventory<=0){
                            //把按钮全部变为灰色
                            $('#setgsvala').css('background','#999');
                            canbuy = 0;
                        }else{
                            $('#setgsvala').css('background','');
                            canbuy = 1;
                        }

                        $(pricespan).html('￥'+price+'/'+gunitname);
                        $(inventoryspan).html('库存'+inventory+gunitname);
                        ginventory = inventory;
                        spBounds = row.spBounds;

                        var nownumber = parseInt($('#goodsnumber').html());
                        if(nownumber<=0){
                            nownumber=1;
                            $('#goodsnumber').html(nownumber);
                        }
                        if(startbuy!=-1&&nownumber<startbuy){
                            nownumber=startbuy;
                            $('#goodsnumber').html(startbuy);
                        }
                        if(nownumber>ginventory){
                            nownumber = ginventory;
                            $('#goodsnumber').html(ginventory);
                        }
                        if(nownumber>spBounds){
                            nownumber = spBounds;
                            $('#goodsnumber').html(spBounds);
                        }
                    }
                }
            });
        }
    }

    <!--加载规格值-->
    function loadgsonce() {
        $.ajax({
            type:"post",
            url:"/goodsGgsrel/queryGgsrelListsOnce",
            dataType: "json",
            data:{gid:gid},
            success:function(data){
                var rows = data.rows;
                if(rows!=null){
                    $('#goodsSpecificatiodiv').html('');
                    var gsvalArr = new Array();
                    for(var i=0;i<rows.length;i++){
                        var gsvids = rows[i].gsvidstr.split(' ');
                        var gsvvals = rows[i].gsvvalstr.split(' ');
                        var selectedgsvids = null;
                        if(rows[i].selectedgsvidstr!=null&&rows[i].selectedgsvidstr.length>0){
                            selectedgsvids = rows[i].selectedgsvidstr.split(' ');
                            var str = '';
                            var index = 0;
                            for(var j=0;j<selectedgsvids.length;j++){
                                for(var k=0;k<gsvids.length;k++){
                                    if(selectedgsvids[j]==gsvids[k]){
                                        str += ','+gsvids[k]+':'+gsvvals[k];
                                        index++;
                                    }
                                }
                            }
                            if(index != 0){
                                str = str.substr(1);
                                str = rows[i].gsname+'_'+str;
                                gsvalArr.push(str);
                            }
                        }
                    }

                    if(gsvalArr!=null && gsvalArr.length>0){
                        $('#gsdiv').html('');
                        var html = '';
                        for(var i=0;i<gsvalArr.length;i++){
                            var gsname = gsvalArr[i].split('_')[0];
                            var gsvalidnames = gsvalArr[i].split('_')[1].split(',');
                            html = '<div class="care-checkbox J_careCheckbox" name="gsdivs">'+
                                '<span class="name">'+gsname+'</span>';
                            for(var j=0;j<gsvalidnames.length;j++){
                                var gsvalid = gsvalidnames[j].split(':')[0];
                                var gsvalname = gsvalidnames[j].split(':')[1];
                                var activeclass = '';
                                if(j==0){
                                    activeclass = 'active';
                                }
                                html += '<span class="checkbox_service '+activeclass+'" onclick="clickactive(this)"><input value="'+gsvalid+'" type="hidden">'+gsvalname+'</span>&nbsp;';
                            }
                            html += '</div>';
                            $('#gsdiv').append(html);
                        }
                    }
                }
            }
        });
    }

    var pdindex=1;
    <!--判断库存-->
    function pdmaxinventory(ysf) {
        var goodsnumber = parseInt($('#goodsnumber').html());

        if(goodsisMultiplebuy==1){
            if(ysf=='+'){
                pdindex++;
                if(pdindex*startbuy>spBounds){
                    layer.msg('最多购买数'+spBounds);
                    $('#goodsnumber').html(spBounds-1);
                    pdindex--;
                }else{
                    $('#goodsnumber').html(pdindex*startbuy-1);
                }
            }else{
                pdindex--;
                if(pdindex==0){
                    pdindex=1;
                    if(startbuy<spBounds){
                        $('#goodsnumber').html(startbuy+1);
                        layer.msg('最少购买数'+startbuy);
                    }else{
                        $('#goodsnumber').html(spBounds);
                        layer.msg('必须小于库存'+spBounds);
                    }

                }else{
                    $('#goodsnumber').html(goodsnumber - startbuy+1);
                }

            }
        }else{
            if(ysf=='+'){
                goodsnumber++;
            }else{
                goodsnumber--;
            }
            if(goodsnumber>spBounds&&spBounds!=0){
                layer.msg("最大购买"+spBounds);
                $('#goodsnumber').html(spBounds-1);
                return;
            }
            if(goodsnumber>ginventory&&ginventory!=0){
                layer.msg("必须小于库存量"+ginventory);
                $('#goodsnumber').html(ginventory-1);
                return;
            }
        }




    }

    <!--确定规格-->
    function suregsa() {
        if(canbuy==0){
            layer.msg('库存不足');
            return;
        }
        var actives = $('#gsdiv').find('.active');
        var gsdivs = $('#gsdiv').find('div[name=gsdivs]');
        if(actives.length>0&&actives.length==gsdivs.length){
            var gsvalid = '';
            var gsval = '';
            for(var i=0;i<actives.length;i++){
                gsvalid += ' '+$(actives[i]).find('input[type=hidden]')[0].value;
                var gsname = $($(actives[i]).siblings()[0]).html()
                gsval += ','+gsname+':'+removeHTMLTag($(actives[i]).html());
            }
            gsvalid = gsvalid.substr(1);
            gsval = gsval.substr(1);

            var gcount = $('#goodsnumber').html();
            var bcPriceHtml = $($('#product').find('span')[0]).html();
            var bcPrice = parseFloat(bcPriceHtml.substr(1,bcPriceHtml.indexOf('/')));
            $('#nowhasgsvalspan').html(gsval+',数量:x'+gcount);
            document.getElementById('closegsdiv').click();
            $('#minprice').html('￥'+bcPrice);

        }else{
            layer.msg("请选择规格");
        }
    }

    <!--立即购买-->
    function buynow() {
        var flag = validatedate();
        if(!flag){
            return;
        }
        var description = '';
        if(isServiceGoods==1){
            var servicetime = $($('#open_time').find('span')[1]).html().trim();
            if(servicetime!=''&&servicetime!='请选择服务时间'){
                description += '服务时间:'+servicetime;
            }
        }else{
            var servicetime = $($('#open_time').find('span')[1]).html().trim();
            if(servicetime!=''&&servicetime!='选择配送时间'){
                description += '配送时间:'+servicetime;
            }
        }
        //alert(description);
    }

    <!--验证-->
    function validatedate() {
        var nowhasgsvalspan = $('#nowhasgsvalspan').html().toString().trim();
        if(nowhasgsvalspan=='请选择规格'){
            layer.msg('请选择规格值');
            return false;
        }
        if(isServiceGoods==1){
            var servicetime = $($('#open_time').find('span')[1]).html().trim();
            if(servicetime=='请选择服务时间'){
                layer.msg('请选择服务时间');
                return false;
            }
        }
        return true;
    }

    <!--设置配送时间-->
    function setpstime() {
        var pstime = $('#pstimeselect').val();
        $($('#open_time').find('span')[1]).html(pstime);
        document.getElementsByClassName('J_careNormsClose3')[0].click();
    }

    <!--加入足迹-->
    function addtofootprint() {
        $.ajax({
            type:"post",
            url:"/userFootprint/saveUserFootprint",
            dataType: "json",
            data:{gid:gid},
            success:function(data){
            }
        });
    }

    <!--加载地址-->
    function loadAddress() {
        $.ajax({
            type:"post",
            url:"/userAddress/queryUserAddress",
            dataType: "json",
            data:{pageNo:1,pageSize:100},
            success:function(data){
                var rows= data.rows;
                if(rows!=null&&rows.length>0){
                    var html = '';
                    $('#addresul').html('');
                    for(var i=0;i<rows.length;i++){
                        var active = '';
                        if(rows[i].uaIsDefault==0){
                            active = 'active';
                        }
                        html = '<li class="'+active+'">'+
                            '<span class="address_img"></span>'+
                            '<div class="address_text">'+rows[i].uaAllAddress+'</div>'+
                            '<span  class="icon_choice"></span>'+
                            '</li>';
                        $('#addresul').append(html);
                    }
                    initaddress();
                    $("#J_mark").show();
                }else{
                    layer.msg('您还未登录');
                }
            }
        });
    }

    <!--加入受邀名单-->
    function addtousershared() {
        $.ajax({
            type:"post",
            url:"/userShared/saveUserShared",
            dataType: "json",
            data:{},
            success:function(data){
            }
        });
    }

    <!--初始化地址-->
    function initaddress() {
        $(".address_list_box>li").click(function(){
            $(".address_list_box>li").removeClass("active")
            $(this).addClass("active")
        })
    }

    <!--查询用户是否购买此商品-->
    function queryuserisbuygoods() {
        $.ajax({
            type:"post",
            url:"/goodsIsbuysp/queryGoodsIsbuysp",
            dataType: "json",
            data:{spId:spId},
            success:function(data){
                var row = data.row;
                if(row!=null){
                    $('.bargain-btn2').hide();
                    $('#putdown').hide();
                    $('#hasBuy').show();
                    $('.special').hide();
                }
            }
        });
    }

    <!--日期格式化-->
    Date.prototype.pattern=function(fmt) {
        var o = {
            "M+" : this.getMonth()+1, //月份
            "d+" : this.getDate(), //日
            "h+" : this.getHours()%12 == 0 ? 12 : this.getHours()%12, //小时
            "H+" : this.getHours(), //小时
            "m+" : this.getMinutes(), //分
            "s+" : this.getSeconds(), //秒
            "q+" : Math.floor((this.getMonth()+3)/3), //季度
            "S" : this.getMilliseconds() //毫秒
        };
        var week = {
            "0" : "/u65e5",
            "1" : "/u4e00",
            "2" : "/u4e8c",
            "3" : "/u4e09",
            "4" : "/u56db",
            "5" : "/u4e94",
            "6" : "/u516d"
        };
        if(/(y+)/.test(fmt)){
            fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
        }
        if(/(E+)/.test(fmt)){
            fmt=fmt.replace(RegExp.$1, ((RegExp.$1.length>1) ? (RegExp.$1.length>2 ? "/u661f/u671f" : "/u5468") : "")+week[this.getDay()+""]);
        }
        for(var k in o){
            if(new RegExp("("+ k +")").test(fmt)){
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
            }
        }
        return fmt;
    }

    $(function(){
        $("#open_car").click(function(){
            $("#J_mark2").show()
        });
        $(".J_careNormsClose2").click(function(){
            $("#J_mark2").hide()
        });
        $(".address_list_box>li").click(function(){
            $(".address_list_box>li").removeClass("active")
            $(this).addClass("active")
        })
    })
</script>

<!--初始化页面调用函数-->
<script>
    <!--加载图片-->
    loadgoodsimage();

    <!--初始化时间-->
    loadtimestape();

    <!--加载生产人采摘人信息-->
    loadpersonaddress();

    <!--加载配置信息-->
    loadgoodsconfig();

    <!--滚动加载商品评论-->
    scrollgoodsclm();

    <!--全部评论数量及平均分数-->
    sumgclandavglevel();

    <!--加载已有评论-->
    loadhasgcl();

    <!--加载商品规格-->
    loadgsonce();

    <!--加入访客-->
    addtousershared();

    <!--加入足迹-->
    addtofootprint();


</script>

<script>
    $(function () {
        <!--图片懒加载-->
        $("img").lazyload({effect: "fadeIn"});
    });
</script>

<script type="text/javascript" src="/js/jweixin-1.2.0.js"></script>
<script>
    $(function(){

        $("#open_car").click(function(){
            $("#J_mark2").show()
        })
        $("#open_time").click(function(){
            $("#J_mark3").show()
        })
        $(".J_careNormsClose").click(function(){
            $("#J_mark").hide()
        })
        $(".J_careNormsClose2").click(function(){
            $("#J_mark2").hide()
        })

        $(".J_careNormsClose3").click(function(){
            $("#J_mark3").hide()
        })
        $("#open_dis").click(function(){
            $("#J_mark4").show()
        })
        $(".J_careNormsClose4").click(function(){
            $("#J_mark4").hide()
        })

        $(".address_list_box>li").click(function(){
            $(".address_list_box>li").removeClass("active")
            $(this).addClass("active")
        })
    });

    <!--返回上一页-->
    function returnhistory() {
        if(document.referrer===''){
            window.location.href='/';
        }else{
            window.history.go(-1);
        }
    }

    var homePath;
    <!--初始化分享-->
    function initShare() {
        $.ajax({
            type:"post",
            url:'/wxShare/createWxShare',
            dataType: "json",
            async :false,
            data:{path:path},
            success:function(data){
                if(data!=null){
                    homePath = data.homePath;

                    var appId = data.appid;
                    var timestamp = data.timestamp;
                    var nonceStr = data.nonceStr;
                    var signature = data.signature;
                    wx.config({

                        //debug: true, // 开启调试模式,调用的所有api的返回值会在客户端//alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。

                        appId: appId, // 必填，公众号的唯一标识

                        timestamp: timestamp, // 必填，生成签名的时间戳

                        nonceStr: nonceStr, // 必填，生成签名的随机串

                        signature: signature,// 必填，签名，见附录1

                        jsApiList: ['onMenuShareTimeline','onMenuShareAppMessage','onMenuShareQQ','onMenuShareWeibo','onMenuShareQZone'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2

                    });

                }

            }
        });
    }

    <!--调用初始化分享-->
    initShare();

    wx.ready(function(){
        var imgUrl = $('#goodsImagesul').find('img')[0].src;
        var title = $('#goodsNameDiv').html();
        var link = homePath;
        var desc = removeHTMLTag($('#gdescription').html());


        //share to timeline
        wx.onMenuShareTimeline({
            title: title, // 分享标题
            desc: desc, // 分享描述
            link:link,
            imgUrl: imgUrl, // 分享图标
            success: function (res) {
                //alert('朋友圈');

                saveShareRecord('朋友圈',title);
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });
        // 获取“分享给朋友”按钮点击状态及自定义分享内容接口
        wx.onMenuShareAppMessage({
            title: title, // 分享标题
            desc: desc, // 分享描述
            link:link,
            imgUrl: imgUrl, // 分享图标
            success: function (res) {
                //alert('好友');
                alert(title);
                saveShareRecord('好友',title);
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });
        // 获取“分享到QQ”按钮点击状态及自定义分享内容接口
        wx.onMenuShareQQ({
            title: title, // 分享标题
            desc: desc, // 分享描述
            link:link,
            imgUrl: imgUrl, // 分享图标
            success: function (res) {
                saveShareRecord('QQ',title);
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });
        // 获取“分享到微博”按钮点击状态及自定义分享内容接口
        wx.onMenuShareWeibo({
            title: title, // 分享标题
            desc: desc, // 分享描述
            link:link,
            imgUrl: imgUrl, // 分享图标
            success: function (res) {
                saveShareRecord('微博',title);
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });
        // 获取“分享到QQ空间”按钮点击状态及自定义分享内容接口
        wx.onMenuShareQZone({
            title: title, // 分享标题
            desc: desc, // 分享描述
            link:link,
            imgUrl: imgUrl, // 分享图标
            success: function (res) {
                saveShareRecord('QQ空间',title);
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });
    });

    <!--记录分享-->
    function saveShareRecord(usWhere,usWhat) {
        $.ajax({
            type:"post",
            url:'/userShare/saveUserShare',
            dataType: "json",
            async :false,
            data:{usWhere:usWhere,usWhat:usWhat},
            success:function(data){
            }
        });
    }

    <!--调用分享函数-->
    function shareGoods() {
        $('.bge6').css('overflow', 'hidden');
        $('.guide-share').fadeIn('slow');
    }

    <!--点击知道了-->
    function ikonw() {
        $('.bge6').css('overflow', 'auto');
        $('.guide-share').fadeOut('slow');
    }

    laydate.render({
        elem: '#select_time' //指定元素
    });
</script>
</body>

</html>