<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.retailers.dht.common.dao.SalePromotionMapper">

	<resultMap id="rm_salePromotion" type="com.retailers.dht.common.entity.SalePromotion">
			<result property="spId" column="sp_id"/>
			<result property="goodsId" column="goods_id"/>
			<result property="goodsName" column="goods_name"/>
			<result property="spPrice" column="sp_price"/>
			<result property="spSale" column="sp_sale"/>
			<result property="spType" column="sp_type"/>
			<result property="spOrder" column="sp_order"/>
			<result property="isCoupon" column="is_coupon"/>
			<result property="spRegion" column="sp_region"/>
			<result property="spInventory" column="sp_inventory"/>
			<result property="spDiscountRate" column="sp_discount_rate"/>
			<result property="spSoldOut" column="sp_sold_out"/>
			<result property="spSaleSize" column="sp_sale_size"/>
			<result property="spBounds" column="sp_bounds"/>
			<result property="spStartTime" column="sp_start_time"/>
			<result property="spEndTime" column="sp_end_time"/>
			<result property="isDelete" column="is_delete"/>
			<result property="version" column="version"/>
	</resultMap>

	<!-- 用于select查询公用抽取的列 -->
	<sql id="salePromotion_columns">
		sp_id,goods_id,goods_name,sp_price,sp_sale,sp_type,sp_order,is_coupon,sp_region,sp_inventory,sp_discount_rate,sp_sold_out,sp_sale_size,sp_bounds,sp_start_time,sp_end_time,is_delete,version
	</sql>
	<!-- 根据商品促销表主键取得数据 -->
	<select id="querySalePromotionBySpId" resultMap="rm_salePromotion" parameterType="java.lang.Long">
		SELECT <include refid="salePromotion_columns" />
		FROM t_sale_promotion WHERE sp_id = #{spId}
	</select>
	<!-- 商品促销表查询条件组合 -->
	<sql id="salePromotion_where">
		<where>
			<if test="null != params.spId">
				AND sp_id = #{params.spId}
			</if>
			<if test="null != params.goodsId">
				AND goods_id = #{params.goodsId}
			</if>
			<if test="null != params.goodsName and '' != params.goodsName">
				AND goods_name = #{params.goodsName}
			</if>
			<if test="null != params.spPrice">
				AND sp_price = #{params.spPrice}
			</if>
			<if test="null != params.spSale">
				AND sp_sale = #{params.spSale}
			</if>
			<if test="null != params.spType">
				AND sp_type = #{params.spType}
			</if>
			<if test="null != params.spOrder">
				AND sp_order = #{params.spOrder}
			</if>
			<if test="null != params.isCoupon">
				AND is_coupon = #{params.isCoupon}
			</if>
			<if test="null != params.spRegion">
				AND sp_region = #{params.spRegion}
			</if>
			<if test="null != params.spInventory">
				AND sp_inventory = #{params.spInventory}
			</if>
			<if test="null != params.spDiscountRate">
				AND sp_discount_rate = #{params.spDiscountRate}
			</if>
			<if test="null != params.spSoldOut">
				AND sp_sold_out = #{params.spSoldOut}
			</if>
			<if test="null != params.spSaleSize">
				AND sp_sale_size = #{params.spSaleSize}
			</if>
			<if test="null != params.spBounds">
				AND sp_bounds = #{params.spBounds}
			</if>
			<if test="null != params.spStartTimeBegin">
				AND sp_start_time &gt;= #{params.spStartTime}
			</if>
			<if test="null != params.spStartTimeEnd">
				AND sp_start_time &lt;= #{params.spStartTime}
			</if>
			<if test="null != params.spEndTimeBegin">
				AND sp_end_time &gt;= #{params.spEndTime}
			</if>
			<if test="null != params.spEndTimeEnd">
				AND sp_end_time &lt;= #{params.spEndTime}
			</if>
			<if test="null != params.isDelete">
				AND is_delete = #{params.isDelete}
			</if>
			<if test="null != params.version">
				AND version = #{params.version}
			</if>
		</where>
	</sql>
	<!--分页查询 -->
	<select id="querySalePromotionList" resultMap="rm_salePromotion" parameterType="com.retailers.mybatis.pagination.Pagination">
		SELECT <include refid="salePromotion_columns" />
		FROM t_sale_promotion
		<include refid="salePromotion_where"/>
	</select>
	<!--添加商品促销表 -->
	<insert id="saveSalePromotion" parameterType="com.retailers.dht.common.entity.SalePromotion" useGeneratedKeys="true" keyProperty="spId">
		INSERT INTO t_sale_promotion (
			goods_id,goods_name,sp_price,sp_sale,sp_type,sp_order,is_coupon,sp_region,sp_inventory,sp_discount_rate,sp_sold_out,sp_sale_size,sp_bounds,sp_start_time,sp_end_time,is_delete,version
		) VALUES
		(
			#{goodsId,jdbcType=BIGINT},#{goodsName,jdbcType=VARCHAR},#{spPrice,jdbcType=BIGINT},#{spSale,jdbcType=BIGINT},#{spType,jdbcType=BIGINT},#{spOrder,jdbcType=BIGINT},#{isCoupon,jdbcType=BIGINT},#{spRegion,jdbcType=BIGINT},#{spInventory,jdbcType=BIGINT},#{spDiscountRate,jdbcType=DOUBLE},#{spSoldOut,jdbcType=BIGINT},#{spSaleSize,jdbcType=BIGINT},#{spBounds,jdbcType=BIGINT},#{spStartTime,jdbcType=TIMESTAMP},#{spEndTime,jdbcType=TIMESTAMP},#{isDelete,jdbcType=BIGINT},0
		)
	</insert>
	<!--修改商品促销表 -->
	<update id="updateSalePromotion" parameterType="com.retailers.dht.common.entity.SalePromotion">
		UPDATE t_sale_promotion
		<set>
            <if test="null != goodsId">
                goods_id = #{goodsId},
            </if>
            <if test="null != goodsName and '' != goodsName">
                goods_name = #{goodsName},
            </if>
            <if test="null != spPrice">
                sp_price = #{spPrice},
            </if>
            <if test="null != spSale">
                sp_sale = #{spSale},
            </if>
            <if test="null != spType">
                sp_type = #{spType},
            </if>
            <if test="null != spOrder">
                sp_order = #{spOrder},
            </if>
            <if test="null != isCoupon">
                is_coupon = #{isCoupon},
            </if>
            <if test="null != spRegion">
                sp_region = #{spRegion},
            </if>
            <if test="null != spInventory">
                sp_inventory = #{spInventory},
            </if>
            <if test="null != spDiscountRate">
                sp_discount_rate = #{spDiscountRate},
            </if>
            <if test="null != spSoldOut">
                sp_sold_out = #{spSoldOut},
            </if>
            <if test="null != spSaleSize">
                sp_sale_size = #{spSaleSize},
            </if>
            <if test="null != spBounds">
                sp_bounds = #{spBounds},
            </if>
            <if test="null != spStartTime">
                sp_start_time = #{spStartTime},
            </if>
            <if test="null != spEndTime">
                sp_end_time = #{spEndTime},
            </if>
            <if test="null != isDelete">
                is_delete = #{isDelete},
            </if>
            <if test="null != version">
                version = version+1,
            </if>
		</set>
		WHERE sp_id = #{spId} and version = #{version}
	</update>
	<!--删除商品促销表 -->
	<delete id="deleteSalePromotionBySpId" parameterType="java.lang.Long">
		DELETE FROM t_sale_promotion WHERE sp_id = #{spId}
	</delete>
</mapper>
